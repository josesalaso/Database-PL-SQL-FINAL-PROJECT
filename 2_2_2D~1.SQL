--SENTENCIA PLSQL

DECLARE
--CURSOR
    CURSOR CUR_POST IS
        SELECT P.RUN RUT, P.DV DVRUT, INITCAP(P.P_NOMBRE||' '|| P.S_NOMBRE||' '|| P.APELLIDO_PA||' '|| P.APELLIDO_MA) NOMBRE,
        SYSDATE FECHA_POSTULACION, INITCAP(EST.NOMBRE) ESTADO_CIVIL, INITCAP(D.DIRECCION) DIRECCION, ESP.NOMBRE SUBESPECIALIDAD_A_LA_QUE_POSTULA,
        INITCAP(INST.NOMBRE) INSTITUCION_ACADEMICA,INITCAP(INST.CIUDAD) CIUDAD,INITCAP(INST.PAIS) PAÍS
        FROM S_POST P
        JOIN S_EST EST ON P.ID_CIVIL = EST.ID_CIVIL
        JOIN S_DIR D ON D.RUN_POST = P.RUN
        JOIN S_POSTU PT ON P.RUN = PT.POST_RUN
        JOIN S_ANTPOST ANT ON PT.ID_POST = ID_POSTUL
        JOIN S_INST INST ON ANT.ID_INST_ACA = INST.ID_INST
        JOIN S_SUBESP ESP ON INST.ID_SUBESP_MED = ESP.ID_SUBESP;

--VARIABLES
    V_VAR1 NUMBER (3);
    V_VAR2 NUMBER (3);

BEGIN
    V_VAR1 := 10;
    V_VAR2 := 1;
    
    FOR REG_CUR_POST IN CUR_POST LOOP
        INSERT INTO S_DETALLES (RUN_POSTULANTE, NOMBRE_POSTULANTE, FECHA_POSTULACION, EST_CIVIL, DIRECCION, SUBESPECIALIDAD_POSTULADA, 
                                              INSTITUCION_ACADEMICA, CIUDAD, PAIS) 
                                              VALUES (SUBSTR(REG_CUR_POST.RUT,1,2)||V_VAR1||SUBSTR(REG_CUR_POST.RUT,3,8)||
                                                      INITCAP(SUBSTR(REG_CUR_POST.NOMBRE,1,2))||'-'||REG_CUR_POST.DVRUT||V_VAR2,
                                                      REG_CUR_POST.NOMBRE, REG_CUR_POST.FECHA_POSTULACION, REG_CUR_POST.ESTADO_CIVIL,
                                                      REG_CUR_POST.DIRECCION, REG_CUR_POST.SUBESPECIALIDAD_A_LA_QUE_POSTULA,
                                                      REG_CUR_POST.INSTITUCION_ACADEMICA, REG_CUR_POST.CIUDAD, REG_CUR_POST.PAÍS);
        V_VAR1 := V_VAR1 + 3;
        V_VAR2 := V_VAR2 + 1;
    END LOOP;
END;


--SENTENCIA SQL PARA VER LA INFORMACION ANTERIOR ALMACENADA EN UNA TABLA.
SELECT * FROM S_DETALLES;
-------------------------------------------------------------------
commit;
rollback;

