CREATE FUNCTION FN_PUNTAJE_INST (PRUN NUMERIC) RETURN NUMERIC
IS
V_RANK    NUMERIC (3);
V_PUNTAJE NUMERIC (3);
BEGIN
    SELECT  INST.RANKING INTO V_RANK FROM POSTULANTE P
            JOIN POSTULACION PS ON P.RUN = PS.POST_RUN
            JOIN ANTECEDENTES_POSTULACION ANT ON PS.ID_POST = ANT.ID_POSTUL
            JOIN INSTITUCION_ACADEMICA INST ON ANT.ID_INST_ACA = INST.ID_INST
            WHERE P.RUN = PRUN;
            BEGIN
                SELECT PUNTAJE INTO V_PUNTAJE FROM PUNTAJE_RANK_INST
                WHERE V_RANK BETWEEN RANK_MIN AND RANK_MAX;
            END;
            RETURN V_PUNTAJE;
END FN_PUNTAJE_INST;

CREATE FUNCTION FN_PUNTAJE_EDAD (PRUN NUMERIC) RETURN NUMERIC
IS
V_EDAD    NUMERIC (3);
V_PUNTAJE NUMERIC (3);
BEGIN
    SELECT TRUNC(MONTHS_BETWEEN(SYSDATE,P.FECHA_NAC)/12) INTO V_EDAD
    FROM POSTULANTE P
    WHERE P.RUN = PRUN;
    BEGIN
        SELECT PUNTAJE INTO V_PUNTAJE FROM PUNTAJE_EDAD
        WHERE V_EDAD BETWEEN ED_MIN AND ED_MAX;
    END;
    RETURN V_PUNTAJE;
END FN_PUNTAJE_EDAD;

CREATE FUNCTION FN_PUNTAJE_LAB (PRUN NUMERIC) RETURN NUMERIC
IS
V_ANNO    NUMERIC (3);
V_PUNTAJE NUMERIC (3);
BEGIN
    V_PUNTAJE := 0;
    SELECT TRUNC(MONTHS_BETWEEN(FECHA_TER,FECHA_INI)/12) INTO V_ANNO FROM POSTULANTE P
    JOIN EXPERIENCIA_LABORAL EXP ON P.RUN = EXP.POSTULANTE_RUN
    WHERE P.RUN = PRUN;
    BEGIN
        SELECT PUNTAJE INTO V_PUNTAJE FROM PUNTAJE_EXP_LAB
        WHERE V_ANNO = ANNOS;
    END;
    RETURN V_PUNTAJE;
END FN_PUNTAJE_LAB;
